syntax = "proto3";
package core.bridge;

import "google/protobuf/any.proto";
import "gogoproto/gogo.proto";
import "bridge/models/party.proto";
import "bridge/models/chain.proto";

option go_package = "github.com/Bridgeless-Project/bridgeless-core/v12/x/bridge/types";


enum EpochStatus {
  INITIATED = 0;
  MIGRATION_FINALIZING = 1;
  RUNNING = 2;
  SHUTDOWN = 3;
  UNSUPPORTED = 4;
}

enum EpochSignatureMod {
  UNSPECIFIED_MOD = 0;
  ADD = 1;
  REMOVE = 2;
}

message Epoch {
  uint32 id = 1;
  EpochStatus status = 2;
  uint64 start_block = 3;
  uint64 end_block = 4;
  // store copy of params here, we do not link to params to avoid issues with params changing over time
  repeated Party parties = 5;
  uint32 tss_threshold = 6;
  repeated TSSInfo tss_info = 7 [(gogoproto.nullable) = false];
  uint64 finalized_block = 8;
}

message EpochSignature {
  EpochSignatureMod mod = 1; //remove or add a signature
  uint32 epoch_id = 2;
  string signature = 3;
  EpochSignatureData data = 4;
}

message EpochSignatureData {
  string new_signer = 1; // address or pub key
  uint64 start_time = 2;
  uint64 end_time = 3;
  string nonce = 4; // is used to prevent replay attacks on EVM chains
}

message EpochChainSignatures {
   uint32 epoch_id = 1;
   ChainType chain_type = 2;
   EpochSignature added_signature = 3;
   EpochSignature removed_signature = 4;
   string address = 5; // address of the contract or account on the chain
   uint32 submittions= 6; // number of times this signature has been submited
}

message TSSInfo {
  string certificate = 1;
  string domen = 2;
  string address = 3;
  bool active = 4; // if is not active it should be removed from signers in this epoch
}